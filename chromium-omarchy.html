<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Chrome Themes: Building DHH's Vision for Omarchy - Helmut Januschka</title>
  <meta name="description" content="How a single tweet led to a Chromium micro fork and a feature that changes how we think about browser theming">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Dynamic Chrome Themes: Building DHH's Vision for Omarchy",
    "description": "How a single tweet led to a Chromium micro fork and a feature that changes how we think about browser theming",
    "author": {
      "@type": "Person",
      "name": "Helmut Januschka",
      "url": "https://januschka.com",
      "sameAs": [
        "https://github.com/hjanuschka",
        "https://twitter.com/hjanuschka",
        "https://linkedin.com/in/hjanuschka"
      ]
    },
    "publisher": {
      "@type": "Person",
      "name": "Helmut Januschka",
      "url": "https://januschka.com"
    },
    "datePublished": "2024-08-01",
    "dateModified": "2026-02-18",
    "image": "https://januschka.com/og-image.png",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://januschka.com/chromium-omarchy.html"
    },
    "keywords": "Chromium, C++, Chromium, Open Source, Browser Development",
    "articleSection": "Technology",
    "inLanguage": "en-US",
    "potentialAction": {
      "@type": "ReadAction",
      "target": "https://januschka.com/chromium-omarchy.html"
    }
  }
  </script>
  
  <!-- Open Graph -->
  <meta property="og:title" content="Dynamic Chrome Themes: Building DHH's Vision for Omarchy">
  <meta property="og:description" content="How a single tweet led to a Chromium micro fork and a feature that changes how we think about browser theming">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://januschka.com/chromium-omarchy.html">
  <meta property="og:site_name" content="Helmut Januschka">
  <meta property="article:author" content="Helmut Januschka">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@hjanuschka">
  <meta name="twitter:title" content="Dynamic Chrome Themes: Building DHH's Vision for Omarchy">
  <meta name="twitter:description" content="How a single tweet led to a Chromium micro fork and a feature that changes how we think about browser theming">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet"></noscript>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"></noscript>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #121212;
      --bg-light: #1e1e1e;
      --bg-lighter: #333333;
      --text: #bebebe;
      --text-dim: #8a8a8d;
      --accent: #FFC107;
      --accent-dim: #e68e0d;
      --border: #333333;
      --orange: #D35F5F;
    }

    /* GitHub Blue Theme */
    [data-theme="blue"] {
      --bg: #0d1117;
      --bg-light: #161b22;
      --bg-lighter: #21262d;
      --text: #ffffff;
      --text-dim: #7d8590;
      --accent: #58a6ff;
      --accent-dim: #1f6feb;
      --border: #30363d;
      --orange: #ff7b72;
    }

    /* Osaka Jade Theme (from Omarchy) */
    [data-theme="osaka-jade"] {
      --bg: #111c18;
      --bg-light: #23372B;
      --bg-lighter: #53685B;
      --text: #C1C497;
      --text-dim: #9eebb3;
      --accent: #2DD5B7;
      --accent-dim: #549e6a;
      --border: #509475;
      --orange: #FF5345;
    }

    /* Purple Moon Theme */
    [data-theme="purple-moon"] {
      --bg: #020007;
      --bg-light: #37277d;
      --bg-lighter: #643aad;
      --text: #ffffff;
      --text-dim: #b895dd;
      --accent: #9b49c8;
      --accent-dim: #9845c6;
      --border: #9865cf;
      --orange: #cd9ce1;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      font-size: 14px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Navigation */
    .nav {
      background: var(--bg-light);
      border-bottom: 3px solid var(--accent);
      padding: 15px 0;
    }

    .nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand {
      font-weight: bold;
      color: var(--accent);
      font-size: 16px;
    }

    .nav-links {
      display: flex;
      gap: 30px;
    }

    .nav-links a {
      color: var(--text);
      text-decoration: none;
      padding: 8px 16px;
      border: 2px solid transparent;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .nav-links a:hover {
      border-color: var(--accent);
      background: var(--bg);
    }

    /* Theme Switcher */
    .theme-switcher {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .theme-dropdown {
      position: relative;
    }

    .theme-button {
      background: var(--bg-light);
      border: 2px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      padding: 8px 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
    }

    .theme-button:hover {
      border-color: var(--accent);
      background: var(--bg);
    }

    .theme-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: #1a1a1a;
      border: 2px solid #333333;
      border-radius: 8px;
      margin-top: 5px;
      min-width: 150px;
      z-index: 1000;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    .theme-menu.show {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .theme-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      color: #ffffff;
      text-decoration: none;
      font-size: 12px;
      transition: background 0.2s ease;
      border: none;
      width: 100%;
      text-align: left;
      background: none;
      cursor: pointer;
      font-family: inherit;
    }

    .theme-option:hover {
      background: #2a2a2a;
      color: #ffffff;
    }

    .theme-option:first-child {
      border-radius: 6px 6px 0 0;
    }

    .theme-option:last-child {
      border-radius: 0 0 6px 6px;
    }

    .theme-preview {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid #666666;
      flex-shrink: 0;
    }

    /* Blog Post Styles */
    .blog-header {
      background: var(--bg-light);
      border-bottom: 3px solid var(--accent);
      padding: 40px 0;
      margin-bottom: 40px;
    }

    .blog-title {
      font-size: 32px;
      color: var(--accent);
      margin-bottom: 15px;
      line-height: 1.2;
    }

    .blog-meta {
      display: flex;
      gap: 20px;
      color: var(--text-dim);
      font-size: 13px;
    }

    .blog-content {
      background: var(--bg-light);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 40px;
      margin-bottom: 40px;
    }

    /* Markdown Content Styles */
    .blog-content h1 {
      color: var(--accent);
      font-size: 28px;
      margin: 30px 0 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
    }

    .blog-content h2 {
      color: var(--orange);
      font-size: 24px;
      margin: 30px 0 15px;
    }

    .blog-content h3 {
      color: var(--accent);
      font-size: 20px;
      margin: 25px 0 15px;
    }

    .blog-content p {
      margin: 15px 0;
      line-height: 1.8;
      color: var(--text);
    }

    .blog-content a {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid var(--accent);
      transition: all 0.3s ease;
    }

    .blog-content a:hover {
      color: var(--orange);
      border-bottom-color: var(--orange);
    }

    .blog-content ul, .blog-content ol {
      margin: 15px 0;
      padding-left: 30px;
    }

    .blog-content li {
      margin: 8px 0;
      line-height: 1.8;
    }

    .blog-content code {
      background: var(--bg);
      color: var(--accent);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
    }

    .blog-content pre {
      background: #1d1f21 !important;
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 20px !important;
      margin: 20px 0;
      overflow-x: auto;
    }

    .blog-content pre code {
      background: none !important;
      color: #c5c8c6 !important;
      padding: 0;
      text-shadow: none !important;
    }

    /* Override Prism theme colors for better integration */
    .token.comment,
    .token.prolog,
    .token.doctype,
    .token.cdata {
      color: #969896 !important;
    }

    .token.punctuation {
      color: #c5c8c6 !important;
    }

    .token.property,
    .token.tag,
    .token.boolean,
    .token.number,
    .token.constant,
    .token.symbol,
    .token.deleted {
      color: #cc6666 !important;
    }

    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.inserted {
      color: #b5bd68 !important;
    }

    .token.operator,
    .token.entity,
    .token.url,
    .language-css .token.string,
    .style .token.string {
      color: #8abeb7 !important;
    }

    .token.atrule,
    .token.attr-value,
    .token.keyword {
      color: #b294bb !important;
    }

    .token.function,
    .token.class-name {
      color: #81a2be !important;
    }

    .token.regex,
    .token.important,
    .token.variable {
      color: #de935f !important;
    }

    .blog-content blockquote {
      border-left: 4px solid var(--accent);
      padding-left: 20px;
      margin: 20px 0;
      color: var(--text-dim);
      font-style: italic;
    }

    .blog-content em {
      color: var(--text-dim);
      font-style: italic;
    }

    .blog-content strong {
      color: var(--accent);
      font-weight: bold;
    }

    /* Table styles */
    .blog-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .blog-content thead,
    .blog-content tbody,
    .blog-content tr {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    .blog-content th {
      background: var(--bg-lighter);
      color: var(--accent);
      padding: 12px 16px;
      text-align: left;
      font-weight: bold;
      border-bottom: 2px solid var(--border);
    }

    .blog-content td {
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }

    .blog-content tr:last-child td {
      border-bottom: none;
    }

    .blog-content tr:hover {
      background: var(--bg-light);
    }

    /* Mobile table responsiveness */
    @media (max-width: 768px) {
      .blog-content table {
        font-size: 11px;
        border: none;
      }

      .blog-content thead {
        display: none;
      }

      .blog-content tbody,
      .blog-content tr {
        display: block;
        width: 100%;
      }

      .blog-content tr {
        margin-bottom: 15px;
        border: 2px solid var(--border);
        border-radius: 8px;
        padding: 10px;
        background: var(--bg);
      }

      .blog-content td {
        display: block;
        text-align: left;
        padding: 8px 0;
        border: none;
        position: relative;
        padding-left: 40%;
      }

      .blog-content td:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 38%;
        padding-right: 10px;
        font-weight: bold;
        color: var(--accent);
        text-align: left;
      }

      /* First column (Image name) */
      .blog-content td:nth-of-type(1):before {
        content: "Image";
      }

      /* Second column (Size) */
      .blog-content td:nth-of-type(2):before {
        content: "Size";
      }

      /* Third column (Before) */
      .blog-content td:nth-of-type(3):before {
        content: "Before";
      }

      /* Fourth column (After) */
      .blog-content td:nth-of-type(4):before {
        content: "After";
      }

      /* Fifth column (C++) */
      .blog-content td:nth-of-type(5):before {
        content: "C++";
      }

      /* Sixth column (Speedup) */
      .blog-content td:nth-of-type(6):before {
        content: "Speedup";
      }
    }

    /* Snippet blocks for inline HTML */
    .snippet-block {
      margin: 20px 0;
      text-align: center;
    }

    .snippet-block img {
      max-width: 100%;
      height: auto;
      border: 2px solid var(--border);
      border-radius: 8px;
    }

    /* YouTube embed container */
    .youtube-embed {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      height: 0;
      overflow: hidden;
      max-width: 100%;
      margin: 30px 0;
      border: 2px solid var(--border);
      border-radius: 8px;
    }

    .youtube-embed iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* Gravatar in nav */
    .gravatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      margin-right: 10px;
      vertical-align: middle;
    }

    /* Status indicator */
    .status {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Footer */
    .footer {
      background: var(--bg-light);
      border-top: 3px solid var(--accent);
      padding: 30px 0;
      margin-top: 60px;
      text-align: center;
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--text-dim);
    }

    .badge {
      background: var(--bg-lighter);
      color: var(--text);
      padding: 4px 10px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 11px;
    }

    /* Command Palette */
    .command-palette {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 15vh;
    }
    .command-palette.hidden { display: none; }
    .command-palette-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }
    .command-palette-modal {
      position: relative;
      width: 100%;
      max-width: 560px;
      margin: 0 20px;
      background: var(--bg-light);
      border: 2px solid var(--accent);
      border-radius: 12px;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.5), 0 0 20px var(--accent);
      overflow: hidden;
    }
    .command-palette-header {
      display: flex;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--border);
      gap: 12px;
    }
    .command-palette-header .prompt {
      color: var(--accent);
      font-weight: bold;
    }
    .command-palette-header input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-family: inherit;
      font-size: 16px;
    }
    .command-palette-header input::placeholder { color: var(--text-dim); }
    .command-palette-header kbd {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 11px;
      color: var(--text-dim);
    }
    .command-results {
      list-style: none;
      max-height: 320px;
      overflow-y: auto;
      margin: 0;
      padding: 8px;
    }
    .command-result {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }
    .command-result:hover, .command-result.selected {
      background: var(--bg-lighter);
    }
    .command-result .icon { font-size: 16px; }
    .command-result .name { flex: 1; color: var(--text); }
    .command-palette-footer {
      display: flex;
      gap: 20px;
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      font-size: 11px;
      color: var(--text-dim);
    }
    .command-palette-footer kbd {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 2px 5px;
      margin-right: 4px;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .blog-title {
        font-size: 24px;
      }
      
      .nav-content {
        flex-direction: column;
        gap: 20px;
      }
      
      .nav-content > div {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-links {
        gap: 15px;
      }
      
      .theme-switcher {
        justify-content: center;
      }
      
      .blog-content {
        padding: 20px;
      }
      
      .footer-content {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="container">
      <div class="nav-content">
        <div class="nav-brand">
          <img src="https://gravatar.com/avatar/7f3d8f25d208327860bdfebf145e481b?s=64"
               alt="Helmut Januschka"
               class="gravatar"
               width="32" height="32">
          <span class="status"></span>
          hjanuschka@world
        </div>
        <div style="display: flex; align-items: center; gap: 30px;">
          <div class="nav-links">
            <a href="/">‚Üê Back to Home</a>
            <a href="/#projects">Projects</a>
            <a href="/#contact">Contact</a>
          </div>
          <div class="theme-switcher">
            <div class="theme-dropdown">
              <button class="theme-button" id="themeButton">
                <span class="theme-preview" style="background: var(--accent);"></span>
                Themes ‚ñº
              </button>
              <div class="theme-menu" id="themeMenu">
                <button class="theme-option" data-theme="matte-black">
                  <span class="theme-preview" style="background: #FFC107;"></span>
                  Matte Black
                </button>
                <button class="theme-option" data-theme="osaka-jade">
                  <span class="theme-preview" style="background: #2DD5B7;"></span>
                  Osaka Jade
                </button>
                <button class="theme-option" data-theme="purple-moon">
                  <span class="theme-preview" style="background: #9b49c8;"></span>
                  Purple Moon
                </button>
                <button class="theme-option" data-theme="blue">
                  <span class="theme-preview" style="background: #58a6ff;"></span>
                  GitHub Blue
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Blog Header -->
  <div class="blog-header">
    <div class="container">
      <h1 class="blog-title">Dynamic Chrome Themes: Building DHH's Vision for Omarchy</h1>
      <div class="blog-meta">
        <span>‚ö° Chromium</span>
        <span>üîß C++</span>
        <span>üë§ Helmut Januschka</span>
      </div>
    </div>
  </div>

  <!-- Blog Content -->
  <article class="container">
    <div class="blog-content">
<p><em>How a single tweet led to a Chromium micro fork and a feature that changes how we think about browser theming</em></p>
<h2>üéâ Update: September 14, 2025 - MERGED &amp; LANDED! A Better Way Through Managed Policies</h2>
<h3>The Golden Nugget Discovery</h3>
<p>Google initially rejected our CLI approach, but working closely with friends at Brave, a crucial insight emerged: <strong>Chrome&#39;s managed policies could set theme colors!</strong> This was a game-changer - policies are an officially supported Chrome feature used by enterprises worldwide.</p>
<p>However, there was a catch: applying policies took 5+ seconds to take effect. This wasn&#39;t the instant response Omarchy users expected.</p>
<h3>Making It Instant</h3>
<p>I dug deeper into Chrome&#39;s policy system and discovered we could add a new flag:</p>
<pre><code class="language-sh"># Instantly refresh and apply platform policies
chromium --refresh-platform-policy
</code></pre>
<p>This flag forces Chrome to immediately reload and apply managed policies without the usual delay. The implications go far beyond just theming - it enables instant policy updates for any managed Chrome setting!</p>
<h3>The Implementation Journey</h3>
<p>After much discussion and collaboration with Chrome&#39;s policy team, we refined the approach. The flag name evolved through several iterations as we better understood the use cases. The final implementation (<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">MERGED</span> <a href="https://crrev.com/c/6900896"><strong>--refresh-platform-policy flag</strong></a>) adds:</p>
<pre><code class="language-cpp">// chrome/common/chrome_switches.cc
const char kRefreshPlatformPolicy[] = &quot;refresh-platform-policy&quot;;

// chrome/browser/ui/startup/startup_browser_creator.cc
// Trigger immediate policy refresh when Chrome is already running
if (command_line.HasSwitch(switches::kRefreshPlatformPolicy)) {
  g_browser_process-&gt;browser_policy_connector()-&gt;RefreshPlatformPolicies();
  // Return early to prevent opening a new browser window
  return;
}
</code></pre>
<p>The beauty of this implementation is its simplicity - just a few lines of code that unlock powerful functionality!</p>
<h3>Official Chrome Release</h3>
<p>This change has landed and will be released in <strong>Chrome Stable 142</strong>! This means:</p>
<ul>
<li>Official support for instant policy updates</li>
<li>No more waiting for policy refresh intervals</li>
<li>Works with any managed policy, not just themes</li>
</ul>
<h3>Omarchy&#39;s Lightning-Fast Integration</h3>
<p>I quickly assembled <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">MERGED</span> <a href="https://github.com/basecamp/omarchy/pull/1251"><strong>Omarchy theme integration</strong></a> that integrates the new flag with JSON policy updates. Here&#39;s how it works in practice:</p>
<pre><code class="language-sh"># Set theme via managed policy (Linux example)
sudo mkdir -p /etc/chromium/policies/managed
echo &#39;{
  &quot;BrowserThemeColor&quot;: &quot;#ff6b35&quot;
}&#39; | sudo tee /etc/chromium/policies/managed/theme.json

# Instantly apply to running Chrome instances
chromium --refresh-platform-policy --no-startup-window
</code></pre>
<p>For macOS users:</p>
<pre><code class="language-sh"># Create policy directory
sudo mkdir -p /Library/Managed\ Preferences/com.google.Chrome

# Set theme color policy
sudo defaults write /Library/Managed\ Preferences/com.google.Chrome BrowserThemeColor -string &quot;#ff6b35&quot;

# Apply instantly
open -a &quot;Google Chrome&quot; --args --refresh-platform-policy --no-startup-window
</code></pre>
<p>This approach is <strong>even faster than our original CLI implementation</strong> because:</p>
<ol>
<li>Policies are read directly from disk (no IPC overhead)</li>
<li>The refresh flag bypasses all delays</li>
<li>Chrome&#39;s native policy system handles the theme application</li>
<li>Works with existing enterprise policy infrastructure</li>
</ol>
<h3>Brave Ships It Early</h3>
<p>Brave has cherry-picked this change and will ship it even faster with their release based on Chrome 141! This shows the power of open-source collaboration - features can reach users through multiple channels.</p>
<h3>The Bigger Picture</h3>
<p>The <code>--refresh-platform-policy</code> flag opens up new possibilities beyond theming:</p>
<ul>
<li>Instant enterprise policy updates without browser restart</li>
<li>Dynamic security policy adjustments</li>
<li>Real-time configuration changes for managed deployments</li>
<li>Scriptable policy management for power users</li>
</ul>
<p>This is a perfect example of how solving one problem (theme switching) led to a more general solution that benefits the entire Chrome ecosystem.</p>
<hr>
<h2>The Tweet That Started Everything</h2>
<p>It began with <a href="https://x.com/hjanuschka/status/1954552977814855845">a challenge from DHH</a> (David Heinemeier Hansson, creator of Ruby on Rails). He wanted something that seemed simple but revealed an interesting gap: the ability to change Chrome&#39;s theme colors dynamically from the command line.</p>
<p>The context was important - when Chrome uses GTK/Qt themes, this already works automatically. But when using Chrome&#39;s &quot;Classic&quot; theme (which many prefer for consistency across platforms), there was no CLI way to control colors. While you could manually change themes through settings for each instance, Omarchy needed scriptable control - just like it has for other applications.</p>
<p>His vision was clear:</p>
<pre><code class="language-sh"># Change theme when using Chrome&#39;s Classic theme
chrome --set-user-color=&quot;255,0,0&quot;
</code></pre>
<p>This wasn&#39;t just about aesthetics. For DHH&#39;s new <a href="https://omarchy.org">Omarchy Linux distribution</a>, this represented a core philosophy: giving power users complete control over their environment through simple, scriptable interfaces.</p>
<h2>Why This Matters</h2>
<p>The gap in Chrome&#39;s theming:</p>
<ul>
<li><strong>GTK/Qt themes</strong>: Work great, update automatically</li>
<li><strong>Classic theme</strong>: No CLI control, must use GUI per instance</li>
<li><strong>Omarchy&#39;s need</strong>: Scriptable theming like other apps have</li>
</ul>
<p>DHH&#39;s request highlighted this inconsistency. Why shouldn&#39;t the Classic theme be as flexible as GTK/Qt integration?</p>
<h2>The Pleasant Surprise</h2>
<p>The implementation turned out to be easier than expected - the code was already in Chromium! The theme system was robust and well-designed. It just wasn&#39;t exposed via command-line interface.</p>
<p>My task was essentially plumbing: connecting existing functionality to a new entry point.</p>
<h2>The Implementation</h2>
<h3>Finding the Existing Code</h3>
<p>Chrome&#39;s theme system was already sophisticated:</p>
<pre><code class="language-cpp">// Theme colors are defined in the ThemeService
class ThemeService : public KeyedService {
  // Material Design 3 (GM3) color generation
  ui::ColorProviderManager::Key GetColorProviderKey();
  
  // This notifies observers when theme changes
  void NotifyThemeChanged();
};
</code></pre>
<p>The Material Design 3 (GM3) theming logic was all there - it just needed a CLI entry point.</p>
<h3>Adding Command-Line Support</h3>
<p>The implementation added several switches that work together:</p>
<pre><code class="language-cpp">// Core theme switches in chrome_switches.cc
const char kSetDefaultTheme[] = &quot;set-default-theme&quot;;      // Reset to system
const char kSetUserColor[] = &quot;set-user-color&quot;;            // GM3 seed color
const char kSetColorScheme[] = &quot;set-color-scheme&quot;;        // light/dark/system
const char kSetColorVariant[] = &quot;set-color-variant&quot;;      // Material variants
const char kSetGrayscaleTheme[] = &quot;set-grayscale-theme&quot;;  // Grayscale overlay
</code></pre>
<p>These switches can be combined for complete control:</p>
<pre><code class="language-sh"># Dark blue vibrant theme
chrome --set-user-color=&quot;100,150,200&quot; \
       --set-color-scheme=&quot;dark&quot; \
       --set-color-variant=&quot;vibrant&quot;

# Light neutral theme with custom color
chrome --set-user-color=&quot;255,107,53&quot; \
       --set-color-scheme=&quot;light&quot; \
       --set-color-variant=&quot;neutral&quot;

# System theme with grayscale
chrome --set-color-scheme=&quot;system&quot; \
       --set-grayscale-theme=&quot;true&quot;
</code></pre>
<h3>Leveraging Chrome&#39;s Theme System</h3>
<p>The beauty was that Chrome already had:</p>
<ul>
<li>Material Design 3 (GM3) dynamic color generation</li>
<li>ProcessSingleton IPC for notifying running instances</li>
<li>ThemeService infrastructure for applying changes</li>
<li>Support for all Material color variants</li>
</ul>
<p>Combined with <code>--no-startup-window</code>, themes update without opening new windows!</p>
<h2>Plan B: The GTK Theme Generator</h2>
<p>While working on the Chrome patch, I also explored an alternative approach: what if we could generate GTK themes using Chrome&#39;s Material Design 3 logic?</p>
<p>This led to <a href="https://github.com/hjanuschka/material-gtk-generator">material-gtk-generator</a>:</p>
<pre><code class="language-sh"># Generate a GTK theme from Chrome&#39;s GM3 colors
material-gtk-generator --seed-color=&quot;#FF6B6B&quot; --output-dir=~/.themes/
</code></pre>
<p>This was Plan B - if the Chromium CL didn&#39;t land, we could:</p>
<ol>
<li>Generate GTK themes matching Chrome&#39;s GM3 palette</li>
<li>Apply them system-wide</li>
<li>Chrome would pick them up automatically</li>
</ol>
<p>It&#39;s still useful for creating cohesive desktop themes!</p>
<h2>The Micro Fork: Getting It to Users Fast</h2>
<p>DHH didn&#39;t want to wait for Google&#39;s review process. He made a decisive move: <strong>invest in build infrastructure</strong> to ship a micro fork immediately.</p>
<h3>What Happened</h3>
<ol>
<li><strong>DHH&#39;s Decision</strong>: &quot;Let&#39;s ship this NOW to Omarchy users&quot;</li>
<li><strong>Build Infrastructure</strong>: DHH funded dedicated build servers</li>
<li><strong>The Micro Fork</strong>: <a href="https://github.com/omacom-io/omarchy-chromium">Omarchy Chromium</a> was born</li>
<li><strong>Immediate Availability</strong>: Users got the feature within days, not months</li>
</ol>
<p>There&#39;s an excellent <a href="https://www.youtube.com/watch?v=ZEFYTdzYxQM">YouTube video by DHH</a> about the power of open source - showing how we went from idea to fork at incredible speed.</p>
<h3>The Patch</h3>
<p>The entire feature is contained in a single CL (<span style="background: #6b7280; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">ABANDONED</span> <a href="https://crrev.com/c/6832165"><strong>Direct CLI approach</strong></a> - superseded by policy approach):</p>
<ul>
<li>Minimal, focused changes</li>
<li>Clean integration with existing code</li>
<li>Easy to maintain and rebase</li>
<li>No invasive modifications</li>
</ul>
<h2>Real-World Usage</h2>
<h3>For Omarchy Users</h3>
<p>Omarchy users just use the built-in theme switcher - it all happens automatically in the background! The system handles the Chrome theming seamlessly alongside other applications.</p>
<h3>For Power Users and Scripters</h3>
<p>The CLI switches enable powerful automation:</p>
<pre><code class="language-sh"># Match browser to terminal theme (Classic theme only)
chromium --set-user-color=&quot;$(get-terminal-color-rgb)&quot;

# Different themes for different workspaces with variants
workspace-1: chromium --set-user-color=&quot;26,26,26&quot; \
                      --set-color-variant=&quot;neutral&quot;
workspace-2: chromium --set-user-color=&quot;0,43,54&quot; \
                      --set-color-variant=&quot;tonal_spot&quot;

# Time-based theming with color schemes
if [[ $(date +%H) -gt 18 ]]; then
  chromium --set-color-scheme=&quot;dark&quot; \
           --set-user-color=&quot;0,0,0&quot;
else
  chromium --set-color-scheme=&quot;light&quot; \
           --set-user-color=&quot;255,255,255&quot;
fi

# Update running instances without opening new window
chromium --no-startup-window \
         --set-user-color=&quot;100,200,150&quot; \
         --set-color-variant=&quot;expressive&quot;
</code></pre>
<p>Note: This works specifically with Chrome&#39;s Classic theme. If you&#39;re using GTK/Qt themes, Chrome already responds to system theme changes automatically.</p>
<h3>Integration with Window Managers</h3>
<p>Window managers can now theme browsers to match the desktop:</p>
<pre><code class="language-python"># Example i3wm integration
import i3ipc
import subprocess

def on_workspace_focus(i3, event):
    workspace = event.current.name
    themes = {
        &quot;1: term&quot;: (&quot;0,0,0&quot;, &quot;dark&quot;, &quot;neutral&quot;),
        &quot;2: web&quot;: (&quot;26,26,46&quot;, &quot;dark&quot;, &quot;tonal_spot&quot;), 
        &quot;3: code&quot;: (&quot;15,52,96&quot;, &quot;dark&quot;, &quot;vibrant&quot;)
    }
    if workspace in themes:
        color, scheme, variant = themes[workspace]
        subprocess.run([
            &quot;chromium&quot;,
            &quot;--no-startup-window&quot;,
            f&quot;--set-user-color={color}&quot;,
            f&quot;--set-color-scheme={scheme}&quot;,
            f&quot;--set-color-variant={variant}&quot;
        ])

i3 = i3ipc.Connection()
i3.on(&quot;workspace::focus&quot;, on_workspace_focus)
i3.main()
</code></pre>
<h2>What&#39;s Next?</h2>
<h3>Upstream Progress</h3>
<p>The direct CLI approach (<span style="background: #6b7280; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">ABANDONED</span> <a href="https://crrev.com/c/6832165"><strong>CL 6832165</strong></a>) was superseded by the policy-based solution (<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">MERGED</span> <a href="https://crrev.com/c/6900896"><strong>CL 6900896</strong></a>), which landed in Chrome 142.</p>
<h3>Extended Features</h3>
<p>The complete feature set includes:</p>
<ul>
<li><strong>Material variants</strong>: tonal_spot, neutral, vibrant, expressive</li>
<li><strong>Color schemes</strong>: light, dark, system</li>
<li><strong>Grayscale mode</strong>: For accessibility</li>
<li><strong>No startup window</strong>: Update running instances silently</li>
<li><strong>GM3 color generation</strong>: Full Material Design 3 palette from seed color</li>
</ul>
<h3>Other Browsers</h3>
<p>Brave has shown interest in downstream landing our patch.</p>
<h2>Try It Yourself</h2>
<h3>For Arch/Omarchy Users</h3>
<p>The AUR package is available (replaces the standard Chromium):</p>
<pre><code class="language-sh">yay -S omarchy-chromium-bin

# Teal expressive theme
chromium --set-user-color=&quot;78,205,196&quot; \
         --set-color-variant=&quot;expressive&quot;

# Reset to default
chromium --set-default-theme
</code></pre>
<hr>
<p><em>Sometimes the best features are already there, waiting to be exposed. Thanks to DHH&#39;s vision and investment, Omarchy users don&#39;t have to wait.</em></p>
<p><strong>Links:</strong></p>
<ul>
<li><a href="https://x.com/hjanuschka/status/1954552977814855845">Original Tweet</a></li>
<li><span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">MERGED</span> <a href="https://crrev.com/c/6900896"><strong>Policy refresh flag</strong></a></li>
<li><span style="background: #6b7280; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">ABANDONED</span> <a href="https://crrev.com/c/6832165"><strong>Direct CLI approach</strong></a></li>
<li><a href="https://github.com/omacom-io/omarchy-chromium">Omarchy Chromium Fork</a></li>
<li><a href="https://github.com/hjanuschka/material-gtk-generator">Material GTK Generator (Plan B)</a></li>
<li><a href="https://www.youtube.com/watch?v=ZEFYTdzYxQM">DHH&#39;s Video: Power of OSS - Idea to Fork</a></li>
<li><a href="https://omarchy.org">Omarchy.org</a></li>
<li><a href="https://world.hey.com/dhh/omarchy-micro-forks-chromium-1287486d">DHH&#39;s Blog Post</a></li>
</ul>
    </div>
  </article>

  <!-- Command Palette -->
  <div id="commandPalette" class="command-palette hidden">
    <div class="command-palette-backdrop"></div>
    <div class="command-palette-modal">
      <div class="command-palette-header">
        <span class="prompt">‚ùØ</span>
        <input type="text" id="commandInput" placeholder="Type a command..." autocomplete="off">
        <kbd>ESC</kbd>
      </div>
      <ul id="commandResults" class="command-results"></ul>
      <div class="command-palette-footer">
        <span><kbd>‚Üë</kbd><kbd>‚Üì</kbd> navigate</span>
        <span><kbd>‚Üµ</kbd> select</span>
        <span><kbd>esc</kbd> close</span>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <span>¬© 2025 Helmut Januschka</span>
        <span class="badge">Powered by marked.js + Terminal Vibes</span>
      </div>
    </div>
  </footer>

  <script>
    // Theme switcher functionality
    const themeButton = document.getElementById('themeButton');
    const themeMenu = document.getElementById('themeMenu');
    const themeOptions = document.querySelectorAll('.theme-option');

    // Toggle theme menu
    themeButton.addEventListener('click', function() {
      themeMenu.classList.toggle('show');
    });

    // Close theme menu when clicking outside
    document.addEventListener('click', function(e) {
      if (!themeButton.contains(e.target) && !themeMenu.contains(e.target)) {
        themeMenu.classList.remove('show');
      }
    });

    // Theme selection
    themeOptions.forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.getAttribute('data-theme');

        if (theme === 'matte-black') {
          document.documentElement.removeAttribute('data-theme');
        } else {
          document.documentElement.setAttribute('data-theme', theme);
        }

        // Save theme preference
        localStorage.setItem('theme', theme);

        // Close menu
        themeMenu.classList.remove('show');
      });
    });

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme && savedTheme !== 'matte-black') {
      document.documentElement.setAttribute('data-theme', savedTheme);
    }

    // Command Palette
    const palette = document.getElementById('commandPalette');
    const paletteInput = document.getElementById('commandInput');
    const paletteResults = document.getElementById('commandResults');
    let selectedIndex = 0;

    const commands = [
      { icon: 'üè†', name: 'Go to Home', keywords: ['home', 'top', 'start'], action: () => window.location.href = '/' },
      { icon: 'üë§', name: 'Go to About', keywords: ['about', 'bio', 'me'], action: () => window.location.href = '/#about' },
      { icon: 'üíº', name: 'Go to Experience', keywords: ['experience', 'work', 'career'], action: () => window.location.href = '/#experience' },
      { icon: 'üöÄ', name: 'Go to Projects', keywords: ['projects', 'code', 'github'], action: () => window.location.href = '/#projects' },
      { icon: 'üìù', name: 'Go to Blog', keywords: ['blog', 'posts', 'articles'], action: () => window.location.href = '/#blog' },
      { icon: 'üìß', name: 'Go to Contact', keywords: ['contact', 'email', 'reach'], action: () => window.location.href = '/#contact' },
      { icon: 'üé®', name: 'Theme: Matte Black', keywords: ['theme', 'matte', 'black', 'dark'], action: () => { document.documentElement.removeAttribute('data-theme'); localStorage.setItem('theme', 'matte-black'); } },
      { icon: 'üåø', name: 'Theme: Osaka Jade', keywords: ['theme', 'osaka', 'jade', 'green'], action: () => { document.documentElement.setAttribute('data-theme', 'osaka-jade'); localStorage.setItem('theme', 'osaka-jade'); } },
      { icon: 'üåô', name: 'Theme: Purple Moon', keywords: ['theme', 'purple', 'moon'], action: () => { document.documentElement.setAttribute('data-theme', 'purple-moon'); localStorage.setItem('theme', 'purple-moon'); } },
      { icon: 'üíô', name: 'Theme: GitHub Blue', keywords: ['theme', 'github', 'blue'], action: () => { document.documentElement.setAttribute('data-theme', 'blue'); localStorage.setItem('theme', 'blue'); } },
      { icon: 'üìã', name: 'Copy Email', keywords: ['copy', 'email', 'clipboard'], action: () => { navigator.clipboard.writeText('helmut@januschka.com'); } },
      { icon: 'üêô', name: 'Open GitHub', keywords: ['github', 'code', 'repos'], action: () => window.open('https://github.com/hjanuschka', '_blank') },
      { icon: 'üê¶', name: 'Open Twitter/X', keywords: ['twitter', 'x', 'social'], action: () => window.open('https://twitter.com/hjanuschka', '_blank') },
      { icon: 'üíº', name: 'Open LinkedIn', keywords: ['linkedin', 'professional'], action: () => window.open('https://linkedin.com/in/hjanuschka', '_blank') },
      { icon: 'üìÑ', name: 'Blog: 2025 Chromium Wrap-Up', keywords: ['blog', '2025', 'chromium', 'owner', 'wrap'], action: () => window.location.href = '/2025-chromium-contributions.html' },
      { icon: 'üìÑ', name: 'Blog: JPEG XL Returns to Chrome', keywords: ['blog', 'jxl', 'jpeg', 'xl', 'rust'], action: () => window.location.href = '/chromium-jxl-resurrection.html' },
      { icon: 'üìÑ', name: 'Blog: Tab Focus Feature', keywords: ['blog', 'tab', 'focus', 'tobi'], action: () => window.location.href = '/chromium-focus-feature.html' },
      { icon: 'üìÑ', name: 'Blog: Dynamic Chrome Themes', keywords: ['blog', 'omarchy', 'theme', 'dhh'], action: () => window.location.href = '/chromium-omarchy.html' },
      { icon: 'üìÑ', name: 'Blog: Wayland Crash Debugging', keywords: ['blog', 'wayland', 'crash', 'debug'], action: () => window.location.href = '/chromium-wayland-crash.html' },
      { icon: 'üìÑ', name: 'Blog: Pi Coding Agent', keywords: ['blog', 'pi', 'agent', 'terminal', 'mario', 'badlogic'], action: () => window.location.href = '/pi-coding-agent.html' },
    ];

    function openPalette() {
      palette.classList.remove('hidden');
      paletteInput.value = '';
      selectedIndex = 0;
      renderResults(commands);
      setTimeout(() => paletteInput.focus(), 10);
    }

    function closePalette() {
      palette.classList.add('hidden');
      paletteInput.value = '';
    }

    function filterCommands(query) {
      if (!query) return commands;
      const q = query.toLowerCase();
      return commands.filter(cmd =>
        cmd.name.toLowerCase().includes(q) ||
        cmd.keywords.some(k => k.includes(q))
      );
    }

    function renderResults(results) {
      paletteResults.innerHTML = results.map((cmd, i) =>
        '<li class="command-result' + (i === selectedIndex ? ' selected' : '') + '" data-index="' + i + '">' +
          '<span class="icon">' + cmd.icon + '</span>' +
          '<span class="name">' + cmd.name + '</span>' +
        '</li>'
      ).join('');
    }

    function executeCommand(results) {
      if (results[selectedIndex]) {
        results[selectedIndex].action();
        closePalette();
      }
    }

    document.addEventListener('keydown', function(e) {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        openPalette();
      }
      if (e.key === 'Escape' && !palette.classList.contains('hidden')) {
        closePalette();
      }
    });

    paletteInput.addEventListener('input', function() {
      const results = filterCommands(this.value);
      selectedIndex = 0;
      renderResults(results);
    });

    paletteInput.addEventListener('keydown', function(e) {
      const results = filterCommands(this.value);
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        selectedIndex = Math.min(selectedIndex + 1, results.length - 1);
        renderResults(results);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        selectedIndex = Math.max(selectedIndex - 1, 0);
        renderResults(results);
      } else if (e.key === 'Enter') {
        e.preventDefault();
        executeCommand(results);
      }
    });

    paletteResults.addEventListener('click', function(e) {
      const item = e.target.closest('.command-result');
      if (item) {
        selectedIndex = parseInt(item.dataset.index);
        executeCommand(filterCommands(paletteInput.value));
      }
    });

    palette.querySelector('.command-palette-backdrop').addEventListener('click', closePalette);

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  </script>
  
  <!-- Prism.js for syntax highlighting -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script>
    // Highlight all code blocks
    Prism.highlightAll();
  </script>
</body>
</html>
